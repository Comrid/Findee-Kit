<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Findee Web Code Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../static/css/style.css">
</head>
<body>
    <div class="editor-container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-code"></i> Findee Web Code Editor</h1>
            <div class="status-info">
                <div class="status-item">
                    <div class="status-dot" id="connectionStatus"></div>
                    <span id="connectionText">Connecting...</span>
                </div>
                <div class="status-item">
                    <div class="status-dot" id="motorStatus"></div>
                    <span>Motor</span>
                </div>
                <div class="status-item">
                    <div class="status-dot" id="cameraStatus"></div>
                    <span>Camera</span>
                </div>
                <div class="status-item">
                    <div class="status-dot" id="ultrasonicStatus"></div>
                    <span>Ultrasonic</span>
                </div>
                <div class="status-item">
                    <span id="systemTime">--:--:--</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Code Editor Section -->
            <div class="editor-section">
                <div class="editor-header">
                    <div class="file-controls">
                        <select id="fileSelect" class="file-select">
                            <option value="">ÌååÏùº ÏÑ†ÌÉù...</option>
                        </select>
                        <button class="btn btn-secondary" onclick="loadFile()">
                            <i class="fas fa-folder-open"></i> Î°úÎìú
                        </button>
                        <button class="btn btn-secondary" onclick="saveFile()">
                            <i class="fas fa-save"></i> Ï†ÄÏû•
                        </button>
                        <button class="btn btn-secondary" onclick="newFile()">
                            <i class="fas fa-file"></i> ÏÉà ÌååÏùº
                        </button>
                    </div>
                    <div class="execution-controls">
                        <button class="btn btn-success" id="runBtn" onclick="runCode()">
                            <i class="fas fa-play"></i> Ïã§Ìñâ
                        </button>
                        <button class="btn btn-danger" id="stopBtn" onclick="stopCode()" disabled>
                            <i class="fas fa-stop"></i> Ï§ëÏßÄ
                        </button>
                        <button class="btn btn-warning" onclick="clearOutput()">
                            <i class="fas fa-trash"></i> Ï∂úÎ†• ÌÅ¥Î¶¨Ïñ¥
                        </button>
                    </div>
                </div>
                
                <div class="editor-wrapper" style="left: -7px; top: 10px;">
                    <div id="monacoEditor" class="monaco-editor"></div>
                </div>
                
                <div class="output-panel">
                    <div class="output-header">
                        <h4><i class="fas fa-terminal"></i> Ïã§Ìñâ Í≤∞Í≥º</h4>
                        <div class="output-status" id="outputStatus">ÎåÄÍ∏∞ Ï§ë...</div>
                    </div>
                    <div class="output-content" id="outputContent">
                        <div class="output-item system">üöÄ Findee Web Code EditorÍ∞Ä Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§.</div>
                        <div class="output-item system">üí° ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Í∞ùÏ≤¥: robot, motor, camera, ultrasonic, time</div>
                        <div class="output-item system">üìù ÏòàÏ†ú ÏΩîÎìúÎ•º ÏûëÏÑ±ÌïòÍ≥† Ïã§ÌñâÌï¥Î≥¥ÏÑ∏Ïöî!</div>
                    </div>
                </div>
            </div>

            <!-- Camera and Control Section -->
            <div class="camera-control-section">
                <!-- Camera Section -->
                <div class="camera-section">
                    <div class="camera-container">
                        <img id="cameraFeed" class="camera-feed" src="/video_feed" alt="Camera Feed" style="image-rendering: pixelated;">
                        <div class="camera-info">
                            <div>FPS: <span id="cameraFps">--</span></div>
                            <div>Resolution: <span id="cameraResolution">--</span></div>
                        </div>
                        <div class="camera-controls">
                            <select id="resolutionSelect" class="resolution-select">
                                <option value="">Ìï¥ÏÉÅÎèÑ ÏÑ†ÌÉù...</option>
                            </select>
                            <button class="btn-camera" onclick="applyCameraResolution()">Ï†ÅÏö©</button>
                        </div>
                    </div>
                </div>

                <!-- Control Panels Section -->
                <div class="control-panels-section">
                    <!-- Motor Control Panel -->
                    <div class="motor-panel">
                        <h3 class="controls-title"><i class="fas fa-gamepad"></i> Î™®ÌÑ∞ Ï†úÏñ¥</h3>
                        
                        <!-- Direction Pad -->
                        <div class="direction-pad">
                            <button class="direction-btn btn-forward-left" data-direction="forward-left" title="Ï†ÑÏßÑ+Ï¢åÌöåÏ†Ñ">‚Üñ</button>
                            <button class="direction-btn btn-forward" data-direction="forward" title="Ï†ÑÏßÑ">‚Üë</button>
                            <button class="direction-btn btn-forward-right" data-direction="forward-right" title="Ï†ÑÏßÑ+Ïö∞ÌöåÏ†Ñ">‚Üó</button>

                            <button class="direction-btn btn-rotate-left" data-direction="rotate-left" title="Ï†úÏûêÎ¶¨ Ï¢åÌöåÏ†Ñ">‚Ü∫</button>
                            <button class="direction-btn btn-stop" data-direction="stop" title="Ï†ïÏßÄ">‚èπ</button>
                            <button class="direction-btn btn-rotate-right" data-direction="rotate-right" title="Ï†úÏûêÎ¶¨ Ïö∞ÌöåÏ†Ñ">‚Üª</button>

                            <button class="direction-btn btn-backward-left" data-direction="backward-left" title="ÌõÑÏßÑ+Ï¢åÌöåÏ†Ñ">‚Üô</button>
                            <button class="direction-btn btn-backward" data-direction="backward" title="ÌõÑÏßÑ">‚Üì</button>
                            <button class="direction-btn btn-backward-right" data-direction="backward-right" title="ÌõÑÏßÑ+Ïö∞ÌöåÏ†Ñ">‚Üò</button>
                        </div>

                        <!-- Speed Control -->
                        <div class="speed-control">
                            <label class="speed-label">ÏÜçÎèÑ Ï°∞Ï†à</label>
                            <input type="range" class="speed-slider" id="speedSlider" min="20" max="100" value="60">
                            <div class="speed-range">
                                <span>20%</span>
                                <div class="speed-value" id="speedValue">60%</div>
                                <span>100%</span>
                            </div>
                        </div>

                        <!-- Motor Status Display -->
                        <div class="motor-status-display">
                            <div class="status-label">ÌòÑÏû¨ Î™ÖÎ†π</div>
                            <div class="status-value" id="motorStatusValue">Î™ÖÎ†π ÏóÜÏùå</div>
                        </div>
                    </div>

                    <!-- Right Column: Ultrasonic + System Info -->
                    <div class="right-panels-column">
                        <!-- Ultrasonic Panel -->
                        <div class="ultrasonic-panel">
                            <h3 class="controls-title"><i class="fas fa-ruler"></i> Ï¥àÏùåÌåå ÏÑºÏÑú</h3>
                            
                            <div class="ultrasonic-display">
                                <div class="distance-card">
                                    <div>ÌòÑÏû¨ Í±∞Î¶¨</div>
                                    <div class="distance-value" id="currentDistance">-- cm</div>
                                </div>
                                <div class="distance-card">
                                    <div>Ï∏°Ï†ï Í∞ÑÍ≤©</div>
                                    <div class="distance-value" style="color: #3b82f6;" id="intervalDisplay">1.0Ï¥à</div>
                                </div>
                            </div>
                            
                            <div class="ultrasonic-controls">
                                <button class="btn btn-success" id="ultrasonicToggleBtn" onclick="toggleUltrasonicMeasurement()">
                                    <i class="fas fa-play"></i> ÏãúÏûë
                                </button>
                                <input type="range" id="intervalRange" min="0.1" max="5" step="0.1" value="1" 
                                       class="interval-slider" onchange="updateInterval()">
                            </div>
                        </div>

                        <!-- System Info Panel -->
                        <div class="system-panel">
                            <h3 class="controls-title"><i class="fas fa-info-circle"></i> ÏãúÏä§ÌÖú Ï†ïÎ≥¥</h3>
                            
                            <div class="system-grid">
                                <div class="system-item">
                                    <div class="label">CPU</div>
                                    <div class="value" id="cpuUsage">--%</div>
                                </div>
                                <div class="system-item">
                                    <div class="label">Ïò®ÎèÑ</div>
                                    <div class="value" id="cpuTemp">--¬∞C</div>
                                </div>
                                <div class="system-item">
                                    <div class="label">Î©îÎ™®Î¶¨</div>
                                    <div class="value" id="memoryUsage">--%</div>
                                </div>
                                <div class="system-item">
                                    <div class="label">IP</div>
                                    <div class="value" id="ipAddress">--</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Code Examples Panel -->
            <div class="examples-panel">
                <h3 class="controls-title"><i class="fas fa-lightbulb"></i> ÏΩîÎìú ÏòàÏ†ú</h3>
                
                <div class="example-buttons">
                    <button class="btn btn-example" onclick="loadExample('basic_usage')">
                        <i class="fas fa-play"></i> Í∏∞Î≥∏ ÏÇ¨Ïö©Î≤ï
                    </button>
                    <button class="btn btn-example" onclick="loadExample('variable_names')">
                        <i class="fas fa-tags"></i> Î≥ÄÏàòÎ™Ö ÏòàÏ†ú
                    </button>
                    <button class="btn btn-example" onclick="loadExample('motor_test')">
                        <i class="fas fa-cog"></i> Î™®ÌÑ∞ ÌÖåÏä§Ìä∏
                    </button>
                    <button class="btn btn-example" onclick="loadExample('ultrasonic_test')">
                        <i class="fas fa-ruler"></i> Ï¥àÏùåÌåå ÌÖåÏä§Ìä∏
                    </button>
                    <button class="btn btn-example" onclick="loadExample('camera_test')">
                        <i class="fas fa-camera"></i> Ïπ¥Î©îÎùº ÌÖåÏä§Ìä∏
                    </button>
                    <button class="btn btn-example" onclick="loadExample('autonomous')">
                        <i class="fas fa-robot"></i> ÏûêÏú® Ï£ºÌñâ
                    </button>
                    <button class="btn btn-example" onclick="loadExample('infinite_loop')">
                        <i class="fas fa-infinity"></i> Î¨¥ÌïúÎ£®ÌîÑ ÏòàÏ†ú
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <!-- JavaScript Î™®ÎìàÎì§ Î°úÎìú -->
    <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/socket-handlers.js') }}"></script>
    <script src="{{ url_for('static', filename='js/robot-controls.js') }}"></script>
    <script src="{{ url_for('static', filename='js/file-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/monaco-config.js') }}"></script>
    <script src="{{ url_for('static', filename='js/editor.js') }}"></script>

    <!-- CSS Ï†ïÏ†Å / url_for() ÌååÏùº Í≤ΩÎ°ú Î≥ÄÍ≤Ω -->
    <script>
        function isFlaskEnvironment() {
            return window.location.protocol === 'http:' || window.location.protocol === 'https:';
        }

        if (isFlaskEnvironment()) {
            // CSS ÌååÏùº Í≤ΩÎ°ú Î≥ÄÍ≤Ω
            const cssLink = document.querySelector('link[href="../static/css/style.css"]');
            if (cssLink) {
                cssLink.href = '/static/css/style.css';
            }
            // ÏΩòÏÜî Î°úÍ∑∏
            console.log('üîß CSS File Reloaded for Flask');
        }
    </script>
</body>
</html>
